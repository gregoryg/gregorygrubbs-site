<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      How to give all new WPMU blogs default properties, theme and pages &middot; Gregory Grubbs Blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="container content">
      <div class="masthead">
        <h3 class="masthead-title">
          <a href="/" title="Home">Gregory Grubbs Blog</a>
          <small>Inattention in software explosion</small>
        </h3>
      </div>

      <div class="post">
  <h1 class="post-title">How to give all new WPMU blogs default properties, theme and pages</h1>
  <span class="post-date">19 Dec 2008</span>
  <p>I've been developing an application on Wordpress-MU and thought I'd share a cool tip.</p>

<p>When new web sites are generated by my client, I wanted the experience to be painless; a one-button ready-to-go web site.</p>

<p>It turns out there is an action hook (of course there is!) when a new blog is created.&nbsp; So let's get down to the nitty gritty and see how to implement it.</p>

<p>I wanted to create a property that would apply to the new web site, which would allow my client to limit what data gets displayed on that site.&nbsp; I also wanted to generate the basic set of pages that I am using to support the sites' URL structure.&nbsp; Each page has a unique template that gives it some special navigation and content mojo.</p>

<p>So first I set the site-global option:</p>

<p><pre lang="php">
add<em>blog</em>option($blog<em>id,<br />
            &#39;campus</em>selection<em>criteria&#39;,<br />
                &quot;CampusStateID LIKE &#39;%&#39;&quot;);<br />
&lt;&#47;pre&gt;</p>
<p>Now for the pages with their templates.&nbsp; In order to let wp</em>insert<em>post know which blog to use, we use a handy function call:</p>
<pre lang="php">
switch</em>to<em>blog($blog</em>id);<br />
&lt;&#47;pre&gt;</p>
<p>We will also need to specify the theme we are using so that the starting theme will be selected and the templates will be correctly associated.</p>
<p>I can then create the pages as I would in Wordpress-non-MU.&nbsp; The final step is to call add<em>action() to hook this code into the blog creation event.</p>
<p>Here is the code in its entirety</p>
<pre lang="php">
function dscp</em>initialize<em>blog($blog</em>id) {<br />
   add<em>blog</em>option($blog<em>id,<br />
                   &#39;campus</em>selection<em>criteria&#39;,<br />
                   &quot;CampusStateID LIKE &#39;%&#39;&quot;);<br />
   switch</em>to<em>blog($blog</em>id);<br />
   &#47;&#47; switch theme<br />
   switch<em>theme(&#39;thematic&#39;, &#39;mychildtheme&#39;);<br />
   $postdata = array(&#39;post</em>parent&#39; =&gt; 0,<br />
   &#39;post<em>status&#39; =&gt; &#39;publish&#39;,<br />
   &#39;post</em>title&#39;&nbsp;&nbsp; =&gt; &#39;DESCRIPTIVE TITLE&#39;,<br />
   &#39;post<em>name&#39;&nbsp; =&gt; &#39;descriptive-title&#39;, &#47;* the slug *&#47;<br />
   &#39;page</em>template&#39; =&gt; &#39;template-whatever.php&#39;,<br />
   &#39;post<em>type&#39;&nbsp;&nbsp; =&gt; &#39;page&#39;);<br />
   $newid = wp</em>insert<em>post($postdata);<br />
   if ($newid &amp;&amp; !is</em>wp<em>error($newid)) {<br />
      add</em>meta($newid);<br />
   } else {<br />
      &#47;&#47; your error handling code<br />
   }<br />
}</p>
<p>add<em>action(&#39;wpmu</em>new<em>blog&#39;, &#39;dscp</em>initialize_blog&#39;);<br />
&lt;&#47;pre&gt;</p></p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="//development/emacs/android/2010/09/11/tips-on-android-development-using-emacs/">
            Tips on Android Development Using Emacs
            <small>11 Sep 2010</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="//emacs/2010/05/23/10-tips-emacs-windows/">
            10 Tips for Powerful Emacs on Windows
            <small>23 May 2010</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="//development/wordpress/emacs/2009/11/15/snippets-with-emacs-lisp-power/">
            Snippets with Emacs Lisp Power
            <small>15 Nov 2009</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


      <div class="footer">
        <p>
          &copy; 2014. All rights reserved.
        </p>
      </div>
    </div>

  </body>
</html>
